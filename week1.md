## Web Server êµ¬í˜„ 1
- ì›¹ ì„œë²„ 1ë‹¨ê³„ - index.html ì‘ë‹µ, 3ë‹¨ê³„ - ë‹¤ì–‘í•œ ì»¨í…ì¸  íƒ€ì… ì§€ì›

### í•™ìŠµ ë‚´ìš©
[ì†Œì¼“, ì…ì¶œë ¥ ìŠ¤íŠ¸ë¦¼, í”„ë¡œì„¸ìŠ¤ì™€ ìŠ¤ë ˆë“œ](https://github.com/sharpie1330/be-was-neon/wiki/%EC%86%8C%EC%BC%93,-%EC%9E%85%EC%B6%9C%EB%A0%A5-%EC%8A%A4%ED%8A%B8%EB%A6%BC,-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4%EC%99%80-%EC%8A%A4%EB%A0%88%EB%93%9C)
- New Client Connect! Connected IP : {}, Port : {} ë¡œê·¸ ë©”ì‹œì§€ì—ì„œ í¬íŠ¸ ë²ˆí˜¸ê°€ ë§¤ë²ˆ ë°”ë€ŒëŠ” ì´ìœ 
    - í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ ìš”ì²­ì„ ë³´ë‚¼ ë•Œ ìš´ì˜ì²´ì œê°€ ë™ì ìœ¼ë¡œ í¬íŠ¸ë¥¼ í• ë‹¹í•´ ì¤€ë‹¤. ìš”ì²­ì„ ë³´ë‚¸ í•´ë‹¹ í¬íŠ¸ë¡œ ì‘ë‹µì„ ë³´ë‚´ë©´ ëœë‹¤.
    - ì„œë²„ ì¸¡ì—ì„œëŠ” 8080í¬íŠ¸ë¡œ ì§€ì •í•´ ì£¼ì—ˆê¸° ë•Œë¬¸ì— í•´ë‹¹ í¬íŠ¸ë¡œ í•­ìƒ listen ì¤‘. ì´ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ë¶„í•˜ëŠ” í¬íŠ¸ ë²ˆí˜¸ê°€ 8080ì´ë‹¤.

### êµ¬í˜„ ë‚´ìš©
- ìš”ì²­ì˜ ì²« ì¤„ì„ ì½ìœ¼ë©´ GETê³¼ ê°™ì€ request methodì™€ request url, HTTP/1.1ê³¼ ê°™ì€ í”„ë¡œí† ì½œ ìˆœì„œë¡œ í‘œì‹œëœë‹¤.
- ë”°ë¼ì„œ í•´ë‹¹ request lineì˜ request urlê³¼ methodë¥¼ íŒŒì‹±í•´ ë¡œê±°ë¡œ ì¶œë ¥í–ˆë‹¤.
- request urlì—ëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ GETì„ ìš”ì²­í•˜ëŠ” ê²½ë¡œê°€ ë‹´ê²¨ìˆê³ , í•´ë‹¹ íŒŒì¼ì˜ í™•ì¥ìì— ë”°ë¼ ContentTypeì„ ë‹¤ë¥´ê²Œ ì²˜ë¦¬í•´ ì‘ë‹µí•´ì£¼ì–´ì•¼ í•œë‹¤.
- ìš°ì„  í•´ë‹¹ ê²½ë¡œì˜ íŒŒì¼ì„ ì°¾ì•„ ë°”ì´íŠ¸ ë°°ì—´ë¡œ ì½ê³ , íŒŒì¼ì˜ í™•ì¥ìë¡œ MimeTypeì„ ê²°ì •í•œë‹¤. ì´ë•Œ nio ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê¸° ìœ„í•´ FileInputStream í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•´ êµ¬í˜„í–ˆë‹¤.
- MimeTypeì€ enum í´ë˜ìŠ¤ë¡œ ë§Œë“¤ì–´ì„œ íŒŒì¼ì˜ í™•ì¥ìì™€ ê°™ì€ ì´ë¦„ì˜ enum ìƒìˆ˜ê°€ ìˆìœ¼ë©´ í•´ë‹¹ ìƒìˆ˜ì˜ mimeTypeê°’ì„ êµ¬í•  ìˆ˜ ìˆë„ë¡ í–ˆë‹¤.

- ì›¹ ì„œë²„ 2ë‹¨ê³„ - GETìœ¼ë¡œ íšŒì›ê°€ì…
### í•™ìŠµ ë‚´ìš©
[[week1] WebServer.java ì˜ˆì œì½”ë“œ ë¶„ì„](https://github.com/sharpie1330/be-was-neon/wiki/%5Bweek1%5D-WebServer.java-%EC%98%88%EC%A0%9C%EC%BD%94%EB%93%9C-%EB%B6%84%EC%84%9D)

### êµ¬í˜„ ë‚´ìš© ë° ë°œìƒ ì´ìŠˆ

[ğŸŒ 301 vs 302 ìƒíƒœ ì½”ë“œ ì°¨ì´ì  (SEO)](https://inpa.tistory.com/entry/HTTP-ğŸŒ-301-vs-302-ìƒíƒœ-ì½”ë“œ-ì°¨ì´ì -ğŸ’¯-ì™„ë²½-ì •ë¦¬)

[HTTP response status codes - HTTP | MDN](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status#information_responses)

- **ê²ªì€ ë¬¸ì œ:**
    - /user/create ìš”ì²­ì— ëŒ€í•´ ì²˜ë¦¬í•œ ë’¤ 301 ë¦¬ë‹¤ì´ë ‰íŠ¸ë¥¼ ì‘ë‹µí•œë‹¤. ì²« ë²ˆì§¸ ì‚¬ìš©ì ìƒì„± ìš”ì²­ì—ì„œëŠ” ì •ìƒì ìœ¼ë¡œ ì²˜ë¦¬ë˜ë‚˜, ê·¸ ì´í›„ ë‹¤ì‹œ ìš”ì²­í•˜ë©´ ìš”ì²­ì´ ì²˜ë¦¬ë˜ì§€ ì•ŠëŠ”ë‹¤. ìºì‹œ ë¬¸ì œì¸ê°€ ì‹¶ì–´ì„œ ìºì‹œë¥¼ ì‚­ì œí–ˆë”ë‹ˆ ì„±ê³µí–ˆë‹¤. ì™œ ê·¸ëŸ´ê¹Œâ€¦?


- 301 Moved Permanently
    - ì˜êµ¬ ë¦¬ë‹¤ì´ë ‰ì…˜
- 302 Found
    - ì¼ì‹œ ë¦¬ë‹¤ì´ë ‰ì…˜

ë¦¬ë‹¤ì´ë ‰ì…˜ì€ í˜ì´ì§€ì˜ ì£¼ì†Œê°€ ë°”ë€Œì—ˆì„ ë•Œë‚˜ ì›¹ì‚¬ì´íŠ¸ë¥¼ ìƒˆë¡œìš´ ë„ë©”ì¸ìœ¼ë¡œ ì˜®ê¸¸ ë•Œ ì´ìš©ìë“¤ë¡œ í•˜ì—¬ê¸ˆ ë³€ê²½ëœ ì£¼ì†Œë¡œ ìë™ìœ¼ë¡œ ì˜®ê²¨ê°€ê²Œ ë§Œë“œëŠ” ë° ì‚¬ìš©ëœë‹¤.

ì´ ë‘˜ì„ êµ¬ë³„í•˜ëŠ” ì£¼ì²´ ëŒ€ìƒì€ â†’ ì‚¬ëŒ X â‡’ ê²€ìƒ‰ ì—”ì§„, ê²€ìƒ‰ ë´‡!

301ì˜ ê²½ìš° ë§ ê·¸ëŒ€ë¡œ ìš”ì²­í•œ ì •ë³´(ì‚¬ì´íŠ¸ë‚˜ í˜ì´ì§€)ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì˜®ê²¨ì ¸ ë‹¤ì‹œëŠ” ëŒì•„ì˜¤ì§€ ì•Šì„ ê²ƒì„ì„ ë§í•´ì¤€ë‹¤.
ì˜ì›íˆ ì´ë™ë˜ì—ˆìœ¼ë‹ˆ, ê²€ìƒ‰ ì—”ì§„ì€ ê¸°ì¡´ URLì— ëŒ€í•œ ì‚¬ì´íŠ¸ ë­í¬ì™€ í‰ê°€ì ìˆ˜ì™€ ê°™ì€ ëª¨ë“  SEO ê°’ê³¼ ë§í¬ ë¦¬ì†ŒìŠ¤ë¥¼ New URLë¡œ ì´ì „, í˜ì´ì§€ì— ëŒ€í•œ ì •ë³´ë„ New URL í˜ì´ì§€ë§Œì„ ìˆ˜ì§‘í•œë‹¤.
í¬í„¸ ê²€ìƒ‰ì— ì´ì „ URLì„ ì—†ì• ì£¼ê³  ìƒˆ URLì„ í‘œì‹œí•˜ê²Œ í•´ì£¼ë©°, ë§í¬ ì‹ í˜¸ë¥¼ í†µí•©í•´ì£¼ê¸° ë•Œë¬¸ì— ì´ì „ URLì˜ ë°±ë§í¬ë“¤ì„ ìƒˆ URLë¥¼ ì§ì ‘ ê°€ë¦¬í‚¤ëŠ” ê²ƒì²˜ëŸ¼ í†µí•©ì‹œì¼œ ì¤€ë‹¤.

302ì˜ ê²½ìš° ë§ê·¸ëŒ€ë¡œ ìš”ì²­í•œ ì •ë³´ê°€ ì¼ì‹œì ìœ¼ë¡œ ì˜®ê²¼ë‹¤ëŠ” ê²ƒì„ ë§í•´ì¤€ë‹¤. ì¦‰, ì–¸ì œë“ ì§€ ì´ì „ URLë¡œ ë‹¤ì‹œ ëŒì•„ì˜¬ ìˆ˜ ìˆë‹¤ëŠ” ëœ». ì»¨í…ì¸ ë§Œ New URLì—ì„œ ì¡°íšŒí•˜ë„ë¡ í•˜ê³ , ë¦¬ë‹¤ì´ë ‰íŠ¸ í–ˆìŒì—ë„ ì—¬ì²œíˆ Old URL í˜ì´ì§€ì— ëŒ€í•œ ì •ë³´ë¥¼ ìˆ˜ì§‘í•œë‹¤.

---

### HttpResponse, HttpHeader í´ë˜ìŠ¤ êµ¬í˜„ ì´ì•¼ê¸°

Http ì‘ë‹µì€ ë‹¤ìŒê³¼ ê°™ì€ êµ¬ì¡°ë¥¼ ê°€ì§„ë‹¤. response line, response header, response body. ì—¬ê¸°ì„œ response lineì€ HTTP ë²„ì „, ìƒíƒœ ì½”ë“œë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤.

ì´ í•­ëª©ë“¤ì„ í•„ë“œë¡œ ê°€ì§€ëŠ” HttpResponse í´ë˜ìŠ¤ë¥¼ êµ¬í˜„í•˜ê³ ì í–ˆë‹¤.

> ì—¬ê¸°ì„œ ë¬¸ì œâ€¦ í—¤ë” ê°’ì˜ ê°œìˆ˜ëŠ” ì •ë§ ë§ê³ , response headerë‚˜ bodyê°€ ì—†ì–´ë„ ë¸Œë¼ìš°ì €ëŠ” ì‘ë‹µë§Œ ë³´ê³  ì¸ì‹í•  ìˆ˜ëŠ” ìˆë‹¤!

headerì˜ ê²½ìš° í•˜ë‚˜ì˜ í‚¤ì— í•˜ë‚˜ì˜ ê°’ë§Œ ì¡´ì¬í•˜ì§€ ì•Šê¸°ì— valueê°€ List<String> í˜•íƒœê°€ ë˜ì–´ì•¼ í•œë‹¤.

ë˜ ë‚˜ëŠ” í•˜ë‚˜ì˜ í‚¤ì™€ í•˜ë‚˜ì˜ ê°’ë§Œ ì¸ìë¡œ ë°›ëŠ” ë©”ì„œë“œë¥¼ ë§Œë“¤ì–´ header ë§µì— ì¶”ê°€í•  ìˆ˜ ìˆë„ë¡ í•˜ê³  ì‹¶ì—ˆê³ , ìƒì„±í•  ë•Œë¶€í„° ì°© ì°© ì°© ì¡°ë¦½í•´ì„œ HttpResponseë¥¼ ë§Œë“¤ì–´ ë‚´ê³  ì‹¶ì—ˆë‹¤!

â‡’ ê·¸ë˜ì„œ **ë¹Œë” íŒ¨í„´**ì„ ì‚¬ìš©í–ˆë‹¤.

ìŠ¤í”„ë§ ë¶€íŠ¸ í”„ë ˆì„ì›Œí¬ì˜ ResponseEntity í´ë˜ìŠ¤ë¥¼ ë³´ê³  ê³µë¶€í•˜ë©° êµ¬í˜„í–ˆë‹¤.

```java
public interface Builder{
        Builder header(String headerName, String... headerValues);

        Builder headers(HttpHeader headers);

        Builder contentLength(long contentLength);

        Builder contentType(MIMEType mimeType);

        Builder location(String location);

        HttpResponse body(byte[] body);

        HttpResponse build();
    }
```

í´ë˜ìŠ¤ ë‚´ë¶€ì— ë‹¤ìŒê³¼ ê°™ì€ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œë“¤ê³ , ResponseBuilderë¼ëŠ” ì •ì  ë‚´ë¶€ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ ìœ„ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í–ˆë‹¤.
ë¹Œë” ìê¸° ìì‹ ì„ ì‘ë‹µí•˜ê³ , ë§ˆì§€ë§‰ build()ë‚˜ body()ì—ì„œ HttpResponseë¥¼ ë°˜í™˜í•˜ë¯€ë¡œ ë©”ì„œë“œ ì²´ì´ë‹ìœ¼ë¡œ í•„ë“œë¥¼ ì±„ìš¸ ìˆ˜ ìˆê³ , ìµœì¢…ì ìœ¼ë¡œ ê°ì²´ë¥¼ ì™„ì„±í•  ìˆ˜ ìˆë‹¤.


â‡’ ë‹¤ìŒ ë¬¸ì œ. **ë„ˆë¬´ ë³µì¡í•œ í—¤ë” í•„ë“œ êµ¬ì¡°**

ì´ê±¸ ì „ë¶€ êµ¬í˜„í•  ë•Œê¹Œì§€ë§Œ í•´ë„ Responseì˜ í—¤ë” í•„ë“œëŠ” Map<String, List<String>> í˜•íƒœì˜€ë‹¤.
HttpHeaderë¼ëŠ” ìƒˆë¡œìš´ í´ë˜ìŠ¤ë¡œ ë¶„ë¦¬í•˜ê³  ì‹¶ì—ˆë‹¤.

ë”°ë¼ì„œ Map<String, List<String>> í˜•íƒœë¥¼ implements í•˜ë„ë¡ í•˜ê³ , ë˜ Map<String, List<String>> í˜•íƒœì˜ headersë¼ëŠ” í•„ë“œë¥¼ private finalë¡œ ê°–ëŠ”ë‹¤. ë¶ˆë³€ì„ ë³´ì¥í•˜ëŠ” ì¼ê¸‰ ì»¬ë ‰ì…˜ì˜ í˜•íƒœë¥¼ ì·¨í•œë‹¤.

ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ë©´ headersë¥¼ HashMapì„ êµ¬í˜„ ê°ì²´ë¡œ ìƒì„±í•˜ê³ , Overrideí•œ ë©”ì„œë“œë„ HashMapì˜ êµ¬í˜„ ë©”ì„œë“œë¥¼ í™œìš©í•´ì„œ êµ¬í˜„í–ˆë‹¤.

ë˜ HttpHeaderë¥¼ ìƒì„±í–ˆìœ¼ë‹ˆ, í•´ë‹¹ í´ë˜ìŠ¤ì˜ ë©”ì„œë“œë¥¼ í™œìš©í•˜ë„ë¡ HttpResponse í´ë˜ìŠ¤ ë‚´ìš©ë„ ë³€ê²½í–ˆë‹¤.

---
- ì•„ì‰¬ìš´ ì 
    - ë¹Œë” íŒ¨í„´ìœ¼ë¡œ ê°ì²´ë¥¼ ë§Œë“¤ ë•Œ ê¸°ë³¸ í—¤ë” ê°’ì´ ì¶”ê°€ë˜ë„ë¡ êµ¬í˜„í•˜ê³  ì‹¶ì—ˆëŠ”ë°, êµ¬í˜„í•˜ì§€ ëª»í–ˆë‹¤.
    - ë”°ë¼ì„œ í•„ìˆ˜ í—¤ë” ê°’ì´ ì—†ì–´ë„ ê°ì²´ëŠ” ìƒì„±ì´ ë˜ì–´ ë¬¸ì œ ì—†ì´ ì½”ë“œê°€ ëŒì•„ê°€ëŠ” ë¬¸ì œê°€ ë‚¨ì•„ ìˆë‹¤. ê°œë°œì ì¸¡ë©´ì—ì„œ ì£¼ì˜í•´ì•¼ í•œë‹¤.
    - HttpHeader í´ë˜ìŠ¤ ë˜í•œ ê°œë°œì ì¸¡ë©´ì—ì„œ ì‚¬ìš©ì— ì£¼ì˜í•´í– í•˜ëŠ” ë©”ì„œë“œë“¤ì´ ë§ì´ ì¡´ì¬í•œë‹¤.
---
### Route ê°ì²´ë¥¼ ì‹±ê¸€í†¤ ê°ì²´ë¡œ

Routeê°ì²´ëŠ” HttpRequestì˜ URL pathë¥¼ êµ¬í•´ì„œ í•„ë“œë¡œ ì„ ì–¸ëœ ë§µì— í•´ë‹¹ pathì™€ ì¼ì¹˜í•˜ëŠ” í‚¤ê°€ ìˆëŠ”ì§€ ì°¾ê³ , ìˆë‹¤ë©´ ê°’ìœ¼ë¡œ ë§¤í•‘ëœ ë©”ì„œë“œë¥¼ ì‹¤í–‰í•˜ê³  HttpResponse ê°ì²´ë¥¼ ë°˜í™˜í•˜ëŠ” ì—­í• ì„ í•œë‹¤.

ì²˜ìŒì—ëŠ” ëª¨ë‘ static ë©”ì„œë“œë¡œ êµ¬ì„±ë˜ì–´ ìˆì—ˆëŠ”ë°, í•´ë‹¹ í´ë˜ìŠ¤ê°€ utilì˜ ì—­í• ì„ í•˜ëŠ” ê²ƒì€ ì•„ë‹ˆì—ˆê¸° ë•Œë¬¸ì— ì¸ìŠ¤í„´ìŠ¤ í´ë˜ìŠ¤ë¡œ ë³€ê²½í–ˆë‹¤.

í•˜ì§€ë§Œ í•´ë‹¹ í´ë˜ìŠ¤ëŠ” ì†Œì¼“ì´ ìƒì„±ë˜ì–´ HTTP ìš”ì²­ì„ ë°›ì„ ë•Œë§ˆë‹¤ ì¸ìŠ¤í„´ìŠ¤ê°€ ìƒì„±ë  í•„ìš”ëŠ” ì—†ì—ˆë‹¤. ìì›ì˜ ë‚­ë¹„ë¼ëŠ” ìƒê°ì´ ë“¤ì–´ ì‹±ê¸€í†¤ í´ë˜ìŠ¤ë¡œ ë³€ê²½í–ˆë‹¤.

---

## 3-Way-HandShaking

```java
14:53:10.846 [DEBUG] [pool-1-thread-2] [webserver.request.RequestHandler] - New Client Connect! Connected IP : /0:0:0:0:0:0:0:1, Port : 50881
14:53:10.846 [DEBUG] [pool-1-thread-1] [webserver.request.RequestHandler] - New Client Connect! Connected IP : /0:0:0:0:0:0:0:1, Port : 50880
14:53:10.848 [ERROR] [pool-1-thread-1] [webserver.request.RequestHandler] - Cannot invoke "String.isEmpty()" because the return value of "java.io.BufferedReader.readLine()" is null
14:53:10.850 [DEBUG] [pool-1-thread-2] [webserver.request.RequestHandler] - request method : POST, request url : /user/create?userId=hello&email=hello%40gmail.com&nickname=hello&password=1234
14:53:10.858 [INFO ] [pool-1-thread-2] [webserver.response.ResponseHandler] - user created successfully! - userId : hello
14:53:10.866 [DEBUG] [pool-1-thread-2] [webserver.request.RequestHandler] - New Client Connect! Connected IP : /0:0:0:0:0:0:0:1, Port : 50882
14:53:10.868 [DEBUG] [pool-1-thread-1] [webserver.request.RequestHandler] - New Client Connect! Connected IP : /0:0:0:0:0:0:0:1, Port : 50883
14:53:10.870 [DEBUG] [pool-1-thread-1] [webserver.request.RequestHandler] - request method : GET, request url : /registration/welcome.html
14:53:10.870 [ERROR] [pool-1-thread-2] [webserver.request.RequestHandler] - Cannot invoke "String.isEmpty()" because the return value of "java.io.BufferedReader.readLine()" is null
```

RequestHandlerì˜ run()ì½”ë“œì—ì„œ NPE ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤!

- ì™œ ê·¸ëŸ´ê¹Œ?

â†’ 50881 í¬íŠ¸ì˜ ì†Œì¼“ ì—°ê²°ì€ 3-way-handshakingì„ ìœ„í•œ ì—°ê²°ë¡œ, ë©”ì‹œì§€ê°€ ì „ì†¡ë˜ì–´ ë“¤ì–´ì˜¤ì§€ ì•ŠëŠ”ë‹¤. ì½”ë“œì—ì„œëŠ” BufferedReaderë¡œ ë¬´ì¡°ê±´ ì²« í•œì¤„ì„ ì½ì–´ request lineìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ”ë°, ì´ ê°’ì´ nullì´ ë˜ì–´ ë¬¸ì œê°€ ë°œìƒí•œ ê²ƒì´ë‹¤.

â‡’ ë‹¤ìŒ ë‹¨ê³„ì—ì„œëŠ” HTTP ìš”ì²­ì´ ë§ëŠ”ì§€ ê²€ì¦í•˜ëŠ” ë¡œì§ì„ ì²¨ë¶€í•˜ì!